Here's a **complete guide** to setting up **Squid as a load balancer** using the config you've outlined. This allows Squid to distribute HTTP requests between two Apache2 servers using **round-robin**.

---

## ğŸ–¥ï¸ Setup Overview

| Role         | IP               | Function                    |
| ------------ | ---------------- | --------------------------- |
| Squid Proxy  | `192.168.80.128` | Acts as proxy/load balancer |
| Web Server 1 | `192.168.80.129` | Apache2 (Client 1)          |
| Web Server 2 | `192.168.80.131` | Apache2 (Deb 1)             |

---

## ğŸ”§ 1. Install Squid (on 192.168.80.128)

```bash
sudo apt update
sudo apt install squid -y
```

---

## ğŸ› ï¸ 2. Configure Squid

Edit the config file:

```bash
sudo nano /etc/squid/squid.conf
```

Add or modify the following lines:

### ğŸ”¹ ACL to restrict access (optional)

```squid
acl my_site_acl dst 192.168.80.128
http_access allow my_site_acl
```

### ğŸ”¹ Set HTTP port with virtual host support

```squid
http_port 80 vhost
```

### ğŸ”¹ Add cache\_peers for load balancing

```squid
cache_peer 192.168.80.129 parent 80 0 no-query round-robin weight=1 name=server1
cache_peer 192.168.80.131 parent 80 0 no-query round-robin weight=1 name=server2
```

### ğŸ”¹ Optional: Allow all access (for testing only â€“ restrict later)

```squid
http_access allow all
```

---

## ğŸ§± 3. Fix `/etc/hosts` (if hostname resolution errors occur)

Edit:

```bash
sudo nano /etc/hosts
```

Add:

```
127.0.0.1   deb
```

You can also map peer IPs if needed:

```
192.168.80.129  server1
192.168.80.131  server2
```

---

## ğŸ”„ 4. Restart Squid

```bash
sudo systemctl restart squid
sudo systemctl status squid
```

---

## ğŸŒ 5. Testing in Browser

1. On your **client browser**, enter:

```
http://192.168.80.128
```

2. Each refresh should load content from either `192.168.80.129` or `192.168.80.131`.

âœ… This demonstrates **round-robin load balancing** between the two Apache servers.

---

## ğŸ§ª Verify Behavior

On Squid:

```bash
tail -f /var/log/squid/access.log
```

You'll see alternating logs for both Apache server IPs.

---

## ğŸ›¡ï¸ Notes

* For **content-specific balancing**, add URL or path-based ACLs.
* You can tune `weight` to prefer one server more.
* Production use: consider adding **health checks** using ICMP or HTTP via scripts.

---

Let me know if you'd like to:

* Add SSL (HTTPS) support
* Implement failover (backup) servers
* Load balance other services like FTP or custom ports
